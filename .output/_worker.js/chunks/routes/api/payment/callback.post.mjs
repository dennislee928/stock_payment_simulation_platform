import{d as e,r as t,c as a,u as s}from"../../../nitro/nitro.mjs";let r={};const o=e((async e=>{const o=await t(e);if(!o||!o.MerchantTradeNo||!o.CheckMacValue)throw a({statusCode:400,statusMessage:"無效的回調請求"});const n=s();n.public.ecpayHashKey,n.public.ecpayHashIV;const c=o.MerchantTradeNo,u=r[c];if(!u)throw a({statusCode:404,statusMessage:"找不到訂單"});return"1"===o.RtnCode?(u.status="success",u.paymentTime=(new Date).toISOString(),u.paymentDetails={paymentType:o.PaymentType,tradeNo:o.TradeNo,amount:o.TradeAmt,paymentDate:o.PaymentDate}):(u.status="failure",u.errorCode=o.RtnCode,u.errorMessage=o.RtnMsg),r[c]=u,{status:"success",message:"已成功接收付款結果"}}));export{o as default};
//# sourceMappingURL=callback.post.mjs.map
