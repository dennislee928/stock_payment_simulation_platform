import{g as t,v as e}from"./server.mjs";const o=t("cart",{state:()=>({items:[],loading:!1}),getters:{totalAmount:t=>t.items.reduce(((t,e)=>t+e.price*e.quantity),0),itemCount:t=>t.items.length,totalQuantity:t=>t.items.reduce(((t,e)=>t+e.quantity),0),formattedTotal:t=>t.items.reduce(((t,e)=>t+e.price*e.quantity),0).toLocaleString("zh-TW",{style:"currency",currency:"TWD"})},actions:{addItem(t,e=1){const o=this.items.findIndex((e=>e.symbol===t.symbol));-1!==o?this.items[o].quantity+=e:this.items.push({...t,quantity:e}),this.saveToStorage()},removeItem(t){this.items=this.items.filter((e=>e.symbol!==t)),this.saveToStorage()},updateQuantity(t,e){const o=this.items.find((e=>e.symbol===t));o&&(o.quantity=e,e<=0?this.removeItem(t):this.saveToStorage())},clearCart(){this.items=[],this.saveToStorage()},saveToStorage(){},loadFromStorage(){},async submitOrder(t){this.loading=!0;try{const e={items:this.items,totalAmount:this.totalAmount,...t},o=await fetch("/api/order/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await o.json();return s.success&&this.clearCart(),s}catch(t){throw console.error("提交訂單時發生錯誤:",t),t}finally{this.loading=!1}}}}),s=t("stocks",{state:()=>({searchResults:[],recentStocks:[],favorites:[],stockCache:{}}),getters:{getStockBySymbol:t=>e=>t.stockCache[e],favoriteStocks:t=>t.favorites.map((e=>t.stockCache[e])).filter(Boolean)},actions:{setSearchResults(t){this.searchResults=t},addToRecent(t){const e=this.recentStocks.findIndex((e=>e.symbol===t.symbol));-1!==e&&this.recentStocks.splice(e,1),this.recentStocks.unshift(t),this.recentStocks.length>5&&this.recentStocks.pop(),this.stockCache[t.symbol]=t},toggleFavorite(t){const e=this.favorites.indexOf(t);-1!==e?this.favorites.splice(e,1):this.favorites.push(t)},cacheStock(t){this.stockCache[t.symbol]=t}}});function useCart(){const t=o(),a=s();function removeFromCart(e){t.removeItem(e)}return{items:e.computed((()=>t.items)),totalItems:e.computed((()=>t.totalItems)),totalAmount:e.computed((()=>t.totalAmount)),formattedTotal:e.computed((()=>t.formattedTotal)),addToCart:function(e,o=1){const s=a.getStockBySymbol(e);if(!s)throw new Error(`找不到股票 ${e} 的資料`);t.addItem({symbol:s.symbol,name:s.name,price:s.price,quantity:o,industry:s.industry})},removeFromCart:removeFromCart,updateQuantity:function(e,o){o<=0?removeFromCart(e):t.updateQuantity(e,o)},clearCart:function(){t.clearCart()},calcTotal:function(){return t.totalAmount},prepareOrderData:function(){return{items:t.items.map((t=>({symbol:t.symbol,name:t.name,price:t.price,quantity:t.quantity,totalAmount:t.price*t.quantity}))),totalAmount:t.totalAmount,orderDate:(new Date).toISOString()}}}}export{s as a,useCart as u};
//# sourceMappingURL=useCart.mjs.map
