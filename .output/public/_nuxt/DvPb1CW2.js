import{a as m}from"./DyhDVP4o.js";import{C as p,k as i,A as u}from"./BkbVJwBK.js";import{u as l}from"./CJzurjDg.js";function w(){p().public.twseApiBase;const o=i(!1),n=i(null),r=m();async function f(t){if(!(!t||t.length<2)){o.value=!0,n.value=null;try{const{data:e}=await l("/api/twse/companies","$6l2edTTtm6");if(!e.value||!Array.isArray(e.value))throw new Error("無法取得公司資料");const c=e.value.filter(a=>{const v=a.Name||"",g=a.Code||"";return v.includes(t)||g.includes(t)}).map(a=>({symbol:a.Code,name:a.Name,industry:a.Industry,price:0}));return c.length>0&&(r.setSearchResults(c),await Promise.all(c.slice(0,5).map(async a=>{await s(a.symbol)}))),c}catch(e){return console.error("搜尋股票時發生錯誤:",e),n.value="搜尋股票時發生錯誤，請稍後再試",[]}finally{o.value=!1}}}async function s(t){try{const{data:e}=await l(`/api/stocks/${t}`,"$7Ngwt8kFVH");return e.value&&e.value.price&&r.cacheStock({...r.getStockBySymbol(t),symbol:t,price:e.value.price,change:e.value.change,changePercent:e.value.changePercent,date:e.value.date}),e.value}catch(e){throw console.error(`取得股票 ${t} 價格時發生錯誤:`,e),new Error(`無法取得股票 ${t} 的價格資訊`)}}return{loading:o,error:n,searchStock:f,getStockPrice:s,recentStocks:u(()=>r.recentStocks),favoriteStocks:u(()=>r.favoriteStocks),toggleFavorite:r.toggleFavorite}}export{w as u};
