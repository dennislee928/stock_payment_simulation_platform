import{D as c,A as n}from"./BkbVJwBK.js";const d=c("cart",{state:()=>({items:[],loading:!1}),getters:{totalAmount:t=>t.items.reduce((e,s)=>e+s.price*s.quantity,0),itemCount:t=>t.items.length,totalQuantity:t=>t.items.reduce((e,s)=>e+s.quantity,0),formattedTotal:t=>t.items.reduce((e,s)=>e+s.price*s.quantity,0).toLocaleString("zh-TW",{style:"currency",currency:"TWD"})},actions:{addItem(t,e=1){const s=this.items.findIndex(r=>r.symbol===t.symbol);s!==-1?this.items[s].quantity+=e:this.items.push({...t,quantity:e}),this.saveToStorage()},removeItem(t){this.items=this.items.filter(e=>e.symbol!==t),this.saveToStorage()},updateQuantity(t,e){const s=this.items.find(r=>r.symbol===t);s&&(s.quantity=e,e<=0?this.removeItem(t):this.saveToStorage())},clearCart(){this.items=[],this.saveToStorage()},saveToStorage(){localStorage.setItem("cart",JSON.stringify(this.items))},loadFromStorage(){{const t=localStorage.getItem("cart");t&&(this.items=JSON.parse(t))}},async submitOrder(t){this.loading=!0;try{const e={items:this.items,totalAmount:this.totalAmount,...t},r=await(await fetch("/api/order/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return r.success&&this.clearCart(),r}catch(e){throw console.error("提交訂單時發生錯誤:",e),e}finally{this.loading=!1}}}}),f=c("stocks",{state:()=>({searchResults:[],recentStocks:[],favorites:[],stockCache:{}}),getters:{getStockBySymbol:t=>e=>t.stockCache[e],favoriteStocks:t=>t.favorites.map(e=>t.stockCache[e]).filter(Boolean)},actions:{setSearchResults(t){this.searchResults=t},addToRecent(t){const e=this.recentStocks.findIndex(s=>s.symbol===t.symbol);e!==-1&&this.recentStocks.splice(e,1),this.recentStocks.unshift(t),this.recentStocks.length>5&&this.recentStocks.pop(),this.stockCache[t.symbol]=t},toggleFavorite(t){const e=this.favorites.indexOf(t);e!==-1?this.favorites.splice(e,1):this.favorites.push(t)},cacheStock(t){this.stockCache[t.symbol]=t}}});function y(){const t=d(),e=f();function s(o,i=1){const a=e.getStockBySymbol(o);if(!a)throw new Error(`找不到股票 ${o} 的資料`);t.addItem({symbol:a.symbol,name:a.name,price:a.price,quantity:i,industry:a.industry})}function r(o){t.removeItem(o)}function u(o,i){if(i<=0){r(o);return}t.updateQuantity(o,i)}function m(){t.clearCart()}function l(){return t.totalAmount}function h(){return{items:t.items.map(o=>({symbol:o.symbol,name:o.name,price:o.price,quantity:o.quantity,totalAmount:o.price*o.quantity})),totalAmount:t.totalAmount,orderDate:new Date().toISOString()}}return{items:n(()=>t.items),totalItems:n(()=>t.totalItems),totalAmount:n(()=>t.totalAmount),formattedTotal:n(()=>t.formattedTotal),addToCart:s,removeFromCart:r,updateQuantity:u,clearCart:m,calcTotal:l,prepareOrderData:h}}export{f as a,y as u};
