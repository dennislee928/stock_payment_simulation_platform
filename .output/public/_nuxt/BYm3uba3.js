import{g,k as m,c as n,a as e,m as h,n as d,v as p,y as v,t as r,F as w,r as _,j as b,o as u}from"./BkbVJwBK.js";import{u as k}from"./DyhDVP4o.js";import{u as M}from"./CJzurjDg.js";const U={class:"max-w-4xl mx-auto"},V={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},E={class:"md:col-span-2"},C={class:"bg-white rounded-lg shadow-md p-6"},D={class:"mb-4"},F={class:"mb-4"},T={class:"mb-6"},j={class:"flex flex-col space-y-3 mb-6"},B={class:"flex items-center space-x-3"},O={class:"flex items-center space-x-3"},q={class:"flex items-center space-x-3"},L={key:0,class:"text-red-500 mb-4"},N=["disabled"],P={key:0},S={key:1},A={class:"md:col-span-1"},J={class:"bg-white rounded-lg shadow-md p-6"},R={class:"divide-y"},W={class:"font-medium"},Y={class:"text-sm text-gray-500"},$={class:"font-medium"},z={class:"mt-4 pt-4 border-t"},G={class:"flex justify-between items-center font-bold"},X=g({__name:"checkout",setup(H){const{items:c,formattedTotal:f,prepareOrderData:y}=k(),i=m(!1),a=m(null),s=m({name:"",email:"",phone:"",paymentMethod:"credit_card"});async function x(){if(!s.value.name||!s.value.email||!s.value.phone){a.value="請填寫完整的聯絡資訊";return}if(c.value.length===0){a.value="購物車是空的，請先選擇股票";return}i.value=!0,a.value=null;try{const o={...y(),contact:{name:s.value.name,email:s.value.email,phone:s.value.phone},paymentMethod:s.value.paymentMethod},{data:t,error:l}=await M("/api/order/submit",{method:"POST",body:o},"$WpFY9aJLT5");if(l.value)throw new Error(l.value.message||"提交訂單時發生錯誤");if(!t.value)throw new Error("未收到後端回應");if(t.value.redirectUrl)window.location.href=t.value.redirectUrl;else throw new Error("未收到付款重定向連結")}catch(o){console.error("結帳時發生錯誤:",o),a.value=typeof o=="string"?o:o instanceof Error?o.message:"結帳時發生未知錯誤"}finally{i.value=!1}}return(o,t)=>(u(),n("div",U,[t[17]||(t[17]=e("h1",{class:"text-3xl font-bold my-8 text-center"},"結帳",-1)),e("div",V,[e("div",E,[e("div",C,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold mb-6"},"聯絡資訊",-1)),e("div",D,[t[6]||(t[6]=e("label",{class:"block text-gray-700 mb-2"},"姓名",-1)),d(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.name=l),type:"text",class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入姓名"},null,512),[[p,s.value.name]])]),e("div",F,[t[7]||(t[7]=e("label",{class:"block text-gray-700 mb-2"},"電子郵件",-1)),d(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.email=l),type:"email",class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入電子郵件"},null,512),[[p,s.value.email]])]),e("div",T,[t[8]||(t[8]=e("label",{class:"block text-gray-700 mb-2"},"手機",-1)),d(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.phone=l),type:"tel",class:"w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"請輸入手機號碼"},null,512),[[p,s.value.phone]])]),t[13]||(t[13]=e("h2",{class:"text-xl font-semibold mb-4"},"付款方式",-1)),e("div",j,[e("label",B,[d(e("input",{type:"radio","onUpdate:modelValue":t[3]||(t[3]=l=>s.value.paymentMethod=l),value:"credit_card",class:"h-5 w-5 text-blue-600"},null,512),[[v,s.value.paymentMethod]]),t[9]||(t[9]=e("span",null,"信用卡付款（模擬）",-1))]),e("label",O,[d(e("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=l=>s.value.paymentMethod=l),value:"atm",class:"h-5 w-5 text-blue-600"},null,512),[[v,s.value.paymentMethod]]),t[10]||(t[10]=e("span",null,"ATM 轉帳（模擬）",-1))]),e("label",q,[d(e("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=l=>s.value.paymentMethod=l),value:"cvs",class:"h-5 w-5 text-blue-600"},null,512),[[v,s.value.paymentMethod]]),t[11]||(t[11]=e("span",null,"超商代碼付款（模擬）",-1))])]),a.value?(u(),n("p",L,r(a.value),1)):h("",!0),e("button",{onClick:x,disabled:i.value,class:"w-full py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition"},[i.value?(u(),n("span",P,"處理中...")):(u(),n("span",S,"確認結帳"))],8,N)])]),e("div",A,[e("div",J,[t[15]||(t[15]=e("h2",{class:"text-xl font-semibold mb-4"},"訂單摘要",-1)),e("div",R,[(u(!0),n(w,null,_(b(c),l=>(u(),n("div",{key:l.symbol,class:"py-3 flex justify-between"},[e("div",null,[e("div",W,r(l.name),1),e("div",Y,r(l.symbol)+" x "+r(l.quantity),1)]),e("div",$,r((l.price*l.quantity).toFixed(2)),1)]))),128))]),e("div",z,[e("div",G,[t[14]||(t[14]=e("span",null,"總計",-1)),e("span",null,r(b(f)),1)])]),t[16]||(t[16]=e("div",{class:"mt-6 text-sm text-gray-500"},[e("p",null,"* 此為模擬結帳系統，不會實際扣款"),e("p",null,"* 使用 ECPay 測試環境")],-1))])])])]))}});export{X as default};
