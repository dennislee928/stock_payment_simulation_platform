import{_ as k}from"./jX1a1AOw.js";import{z as A,A as x,g as M,k as g,q as C,c as o,a as t,t as u,b as f,w as _,F as D,r as E,o as a,d as b,p as I}from"./BkbVJwBK.js";import{u as T}from"./CJzurjDg.js";function V(){const r=A();function p(l,d){return new Promise(h=>{setTimeout(()=>{const c=`mock_token_${Math.random().toString(36).substring(2,15)}`;r.login({id:"1",name:l.split("@")[0],email:l},c),h(!0)},1e3)})}function m(){r.logout()}function i(){return r.checkAuth(),r.isAuthenticated}return{isAuthenticated:x(()=>r.isAuthenticated),user:x(()=>r.user),username:x(()=>r.username),login:p,logout:m,checkAuth:i}}const z={class:"max-w-6xl mx-auto px-4"},B={key:0,class:"text-center py-12"},F={key:1,class:"bg-red-50 text-red-700 p-6 rounded-lg text-center"},N={key:2,class:"bg-white rounded-lg shadow-md p-8 text-center"},S={key:3,class:"bg-white rounded-lg shadow-md overflow-hidden"},L={class:"w-full"},$={class:"py-3 px-4"},O={class:"py-3 px-4"},j={class:"py-3 px-4"},q={key:0},H={key:1},P={key:2},U={key:3},W={class:"py-3 px-4 text-right font-medium"},G={class:"py-3 px-4 text-center"},J={class:"py-3 px-4 text-center"},X=M({__name:"orders",setup(r){const{isAuthenticated:p,login:m}=V(),i=g([]),l=g(!0),d=g(null);async function h(){await m("demo@example.com","password")}async function c(){l.value=!0,d.value=null;try{const{data:s,error:e}=await T("/api/orders","$UEDAcO31c7");if(e.value)throw new Error("無法獲取訂單資料");i.value=s.value||[]}catch(s){console.error("獲取訂單時發生錯誤:",s),d.value=typeof s=="string"?s:s instanceof Error?s.message:"載入時發生未知錯誤"}finally{l.value=!1}}C(async()=>{p.value||await h(),await c()});function w(s){switch(s){case"success":return"交易成功";case"pending":return"處理中";case"failure":return"交易失敗";default:return"未知狀態"}}function v(s){if(!s)return"-";const e=new Date(s);return new Intl.DateTimeFormat("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(e)}return(s,e)=>{const y=k;return a(),o("div",z,[e[6]||(e[6]=t("h1",{class:"text-3xl font-bold my-8 text-center"},"訂單管理",-1)),l.value?(a(),o("div",B,e[0]||(e[0]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"},null,-1),t("p",null,"正在載入訂單資料...",-1)]))):d.value?(a(),o("div",F,[e[1]||(e[1]=t("p",{class:"font-bold"},"載入失敗",-1)),t("p",null,u(d.value),1),t("button",{onClick:c,class:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"}," 重試 ")])):i.value.length===0?(a(),o("div",N,[e[3]||(e[3]=t("div",{class:"text-gray-500 mb-4"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-16 w-16 mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),t("p",{class:"text-lg mb-2"},"目前沒有訂單記錄"),t("p",null,"完成交易後，訂單會顯示在這裡")],-1)),f(y,{to:"/",class:"inline-block mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"},{default:_(()=>e[2]||(e[2]=[b(" 開始購買 ")])),_:1})])):(a(),o("div",S,[t("table",L,[e[5]||(e[5]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"py-3 px-4 text-left"},"訂單編號"),t("th",{class:"py-3 px-4 text-left"},"建立時間"),t("th",{class:"py-3 px-4 text-left"},"付款方式"),t("th",{class:"py-3 px-4 text-right"},"金額"),t("th",{class:"py-3 px-4 text-center"},"狀態"),t("th",{class:"py-3 px-4 text-center"},"操作")])],-1)),t("tbody",null,[(a(!0),o(D,null,E(i.value,n=>(a(),o("tr",{key:n.orderId,class:"border-t border-gray-200"},[t("td",$,u(n.orderId),1),t("td",O,u(v(n.createdAt)),1),t("td",j,[n.paymentMethod==="credit_card"?(a(),o("span",q,"信用卡")):n.paymentMethod==="atm"?(a(),o("span",H,"ATM 轉帳")):n.paymentMethod==="cvs"?(a(),o("span",P,"超商代碼")):(a(),o("span",U,u(n.paymentMethod),1))]),t("td",W,u(n.totalAmount),1),t("td",G,[t("span",{class:I(["inline-block px-3 py-1 rounded-full text-sm",{"bg-green-100 text-green-800":n.status==="success","bg-yellow-100 text-yellow-800":n.status==="pending","bg-red-100 text-red-800":n.status==="failure"}])},u(w(n.status)),3)]),t("td",J,[f(y,{to:`/result?orderId=${n.orderId}`,class:"text-blue-600 hover:text-blue-800 underline"},{default:_(()=>e[4]||(e[4]=[b(" 查看詳情 ")])),_:2},1032,["to"])])]))),128))])])]))])}}});export{X as default};
