# Next.js App Router 開發環境與核心概念

本文將介紹使用 Next.js App Router 進行開發時的環境設定、專案結構、樣式處理、部署以及測試等方面的重要概念，並透過 Mermaid 圖表進行抽象概念的說明。

## 開發環境設定 (Development Environment Setup)

要開始 Next.js 的開發，您需要具備特定版本的 Node.js。根據來源 [1] 的說明，建議您使用 **Node.js 16.8 或更高版本**。您可以前往 `nodejs.org` 下載最新版本 [1]。

建立新的 Next.js 專案，可以使用 `npx create-next-app` 命令 [2]。在執行此命令後，系統會詢問您專案的名稱以及是否使用 TypeScript、ESLint、Tailwind CSS、`src` 目錄、App Router 和自訂的 import alias 等選項 [2]. 來源 [2] 中建議在本課程中使用 **Next.js 13.4 版本**，以避免在學習過程中遇到困難。執行 `npx create-next-app@13.4.13 <專案名稱>` 即可建立指定版本的專案 [2]。

建立專案後，您可以進入專案目錄並使用 `npm run dev` 命令來啟動開發伺服器 [2, 3]。這會在 **Port 3000** 上啟動您的應用程式，您可以透過瀏覽器存取 `http://localhost:3000` 來查看 [2, 3]。來源 [4] 也提到 `npm run dev` 用於啟動開發伺服器。

## 專案結構 (Project Structure)

在 Next.js 專案中，**`app` 資料夾是使用 App Router 的核心** [3, 5]。它作為路由系統的容器，Next.js 的路由是基於檔案系統的，您不需要像在使用 React Router 那樣手動配置路由和組件的映射，而是透過建立檔案和資料夾來表示路由 [5]。

**`public` 資料夾用於存放靜態資源**，例如圖片 [3, 5]。在這個資料夾中的資源可以直接透過應用程式的根路徑存取 [3, 5]。

**「Route Groups」** 允許您在 `app` 資料夾中組織路由，而不會影響 URL 路徑結構 [6]。例如，`(root)` 可以用來將某些頁面組織在一個群組下，而這些頁面的 URL 路徑仍然會是根路徑下的直接路徑 [6]。來源 [6] 的範例展示了如何建立一個名為 `(root)` 的路由群組來組織首頁相關的檔案。

在專案的根目錄中，還有一些重要的設定檔，例如 `.eslintrc.json` (ESLint 設定檔)、`next.config.js` (Next.js 設定檔)、`postcss.config.js` (PostCSS 設定檔)、`tailwind.config.js` (Tailwind CSS 設定檔) 和 `tsconfig.json` (TypeScript 設定檔) [3, 5, 7]。通常情況下，您不需要修改這些設定檔，但在需要進行更進階的配置時，可以回來修改它們 [5]。

## 樣式 (Styling)

Next.js **內建支援 CSS Modules** [8]。當您建立一個以 `.module.css` 或 `.module.scss` 結尾的 CSS 檔案時，Next.js 會自動將其轉換為 CSS Modules，確保樣式的局部作用域，避免樣式衝突 [8]。來源 [8] 的範例展示了如何建立一個 `ProductCard.module.css` 檔案，並在 TypeScript 檔案中使用 `styles.card` 來應用樣式，這些類別名稱會在編譯時自動產生唯一的名稱 [8]。

Next.js 專案在建立時可以**選擇整合 Tailwind CSS** [2, 3, 7, 8]。Tailwind CSS 是一個基於 utility classes 的 CSS 框架，可以讓您快速地為元素添加樣式 [8]。來源 [2] 在專案建立時詢問是否使用 Tailwind CSS，選擇「是」即可完成整合 [2, 7]。您可以在 `global.css` 檔案中 `@import` Tailwind CSS 的指令 [3, 9, 10]，並在組件的 `className` 屬性中使用 Tailwind 的 utility classes 來設定樣式 [8]。來源 [9] 和 [10] 也提到了 `global.css` 檔案用於匯入 Tailwind CSS 和定義全域樣式。

## 部署 (Deployment)

**Vercel 是 Next.js 的原生平台**，由 Next.js 的開發公司 Vercel 維護 [11]。它專為 Next.js 應用程式設計，提供了**零配置部署和效能優化** [11-13]。來源 [13] 提到 Next.js 內建許多效能優化功能，並且 Vercel 會自動處理擴展 (scaling) 等伺服器基礎設施 [13]。

當您將 Next.js 專案連接到 Vercel 時，每次您建立一個 Pull Request，Vercel 會自動為該 PR **產生一個預覽 URL** [14]。這讓您可以方便地在部署到生產環境之前預覽和測試您的變更 [14]。來源 [14] 的標題提到了 Vercel 對專案和部署的管理。

## 測試 (Testing)

Next.js 應用程式可以**整合 Jest 和 React Testing Library 進行單元測試和整合測試** [15-18]。來源 [15] 的影片介紹了如何在 Next.js 專案中使用 Jest、React Testing Library 和 TypeScript 進行測試環境的設定。您需要安裝相關的開發依賴套件，例如 `jest`、`@types/jest`、`ts-jest`、`@testing-library/react` 和 `@testing-library/jest-dom` 等 [16, 19]。這些套件可以使用 `npm install -D <套件名稱>` 或 `yarn add -D <套件名稱>` 來安裝 [16, 19]。來源 [19] 和 [16] 都提到了將測試相關套件安裝為開發依賴 (`-D`)。

您可能需要**設定 Jest 相關配置**，例如在專案根目錄建立 `jest.config.js` 檔案 [20]。這個檔案用於配置 Jest 的行為，例如測試檔案的匹配模式、轉換器、測試環境等 [20]。來源 [20] 展示了一個 `jest.config.js` 的範例，用於配置 Next.js 專案的測試環境。

此外，您也可以使用 **Playwright 進行端對端測試 (End-to-End Testing)** [21-23]。Playwright 是一個由 Microsoft 開發的測試工具，可以模擬真實使用者在瀏覽器中的操作，測試應用程式的完整流程 [21]。來源 [21] 的影片全面介紹了如何使用 Playwright 測試 React 應用程式。安裝 Playwright 可以使用 `npm install -D playwright` 或 `yarn add -D playwright` [22]。

## 抽象概念圖 (Mermaid)

以下 Mermaid 圖表說明了 Next.js App Router 的開發流程中各個核心概念的關係：

```mermaid
graph TD
    A[開發環境設定 (Node.js, Next.js CLI)] --> B(建立專案結構 (app, public, route groups));
    B --> C(實作樣式 (CSS Modules, Tailwind CSS));
    C --> D(編寫測試 (Jest, React Testing Library, Playwright));
    D --> E(部署應用程式 (Vercel));
    E --> F{使用者存取應用程式};
    F -- 發現問題/提出新功能 --> A;

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style B,C,D,E,F fill:#fff,stroke:#333,stroke-width:1px

圖表說明：
1.
開發環境設定 是開始 Next.js 專案的第一步，包括安裝必要的 Node.js 版本和 Next.js CLI 工具。
2.
設定完成後，需要建立專案結構，這涉及到了解 app 資料夾作為 App Router 核心的重要性，public 資料夾用於存放靜態資源，以及如何使用 route groups 來組織路由。
3.
接下來是實作樣式，Next.js 支援 CSS Modules 和 Tailwind CSS 等樣式方案。
4.
為了確保應用程式的品質，需要編寫測試，可以使用 Jest 和 React Testing Library 進行組件測試，或使用 Playwright 進行端對端測試。
5.
完成開發和測試後，應用程式可以部署到 Vercel，Vercel 作為 Next.js 的原生平台，提供了優化的部署體驗。
6.
一旦應用程式部署完成，使用者可以存取應用程式。
7.
在應用程式的使用過程中，如果發現問題或需要新增功能，將會回到開發環境設定階段，開始新一輪的開發流程。
總結
本文介紹了 Next.js App Router 開發中的開發環境設定、專案結構、樣式處理、部署和測試等關鍵概念。透過理解這些概念和工具，您可以更有效地使用 Next.js App Router 開發高效能的 Web 應用程式。
```
